<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: endpoints/index.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: endpoints/index.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>
var FileCache = require ('FileCache');

/**
Adds or removes directories from the file index.
@name endpoint_index
@module
*/
/**
@name configuration
@memberOf endpoint_index
@class
*/
var config = {
};

/**
Set configuration options.
@param {endpoint_index.configuration} newConf
*/
var configure = function (newConf) {
    config.merge (newConf);
};

/**
Finalize config and prepare to react to requests.
@param {function} callback
*/
var start = function (callback) {
    process.nextTick (callback);
};

var skiplen = "/index/".length;

/**
React to a request, reply and close response.
@param request
@param response
*/
var react = function (request, response) {
    var dir = request.url.slice (skiplen);
    if (
        dir[0] == '.' ||
        dir.indexOf ('./') >= 0 || 
        dir.match (/[^\\]\/\./)
    ) {
        // index contains local path, ../ or accesses a hidden dir
        var result = '"index malformed"';
        response.writeHead (400, {
            "Content-Type":         "application/json",
            "Content-Length":       result.length
        });
        response.end (result);
    }
    
    if (request.method.toLowerCase() == "post") {
        FileCache.indexDirectory (dir, function (found) {
            if (found) {
                var result = '"index ok"';
                response.writeHead (200, {
                    "Content-Type":         "application/json",
                    "Content-Length":       result.length
                });
                response.end (result);
                return;
            }
            
            var result = '"index not found"';
            response.writeHead (404, {
                "Content-Type":             "application/json",
                "Content-Length":           result.length
            });
            response.end (result);
        });
    } else if (request.method.toLowerCase() == "delete")
        FileCache.dropDirectory (dir, function () {
            var result = '"index deleted"';
            response.writeHead (200, {
                "Content-Type":         "application/json",
                "Content-Length":       result.length
            });
            response.end (result);
        });
    else {
        var result = '"index invalid verb"';
        response.writeHead (404, {
            "Content-Type":             "application/json",
            "Content-Length":           result.length
        });
        response.end (result);
    }
};


module.exports = {
    configure:          configure,
    start:              start,
    react:              react
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-endpoint_data.html">endpoint_data</a></li><li><a href="module-endpoint_index.html">endpoint_index</a></li><li><a href="module-FileCache.html">FileCache</a></li><li><a href="module-masspec-glue.html">masspec-glue</a></li></ul><h3>Classes</h3><ul><li><a href="endpoint_getFile.configuration.html">configuration</a></li><li><a href="endpoint_index.configuration.html">configuration</a></li><li><a href="FileCache.configuration.html">configuration</a></li><li><a href="masspec-glue.configuration.html">configuration</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-dev</a> on Mon Nov 11 2013 13:46:54 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
